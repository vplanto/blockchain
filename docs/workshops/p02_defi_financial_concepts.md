# Практикум p02: Фінансові примітиви DeFi (DeFi Fundamentals)

**Мета:** Зрозуміти базові економічні та фінансові концепти, на яких будується децентралізовані фінанси (DeFi), без занурення в складну математику або код смарт-контрактів.
**Формат:** Міркування, приклади з життя та розбір механіки на пальцях.

---

## 1. Пули ліквідності (Liquidity Pools) та AMM

У традиційних фінансах (Web2 біржі, як Binance або фондовий ринок) ціна формується через **Книгу ордерів (Order Book)**. Є покупці (bid) і продавці (ask). Біржа просто зводить їх разом. 
У блокчейні зберігати книгу ордерів і постійно її оновлювати марнотратно через вартість газу. Тому в DeFi винайшли **AMM (Automated Market Maker)**.

### Як це працює?
Замість того, щоб торгувати з іншою людиною, ви торгуєте з **роботом (смарт-контрактом)**, у якого є мішок з двома активами (наприклад, ETH та USDC). Цей "мішок" називається **Пулом ліквідності**.

**Гроші в цей мішок кладуть звичайні користувачі** (Провайдери ліквідності, або LP). За це вони отримують відсоток з кожної транзакції, яку роблять трейдери.

### Формула ціни (Constant Product)
Найпростіша формула (використовується в Uniswap V2): **X * Y = K**
- $X$ — кількість першого токена (ETH)
- $Y$ — кількість другого токена (USDC)
- $K$ — константа, яка незмінна під час одного обміну.

**Приклад на пальцях:**
У пулі є **10 ETH** та **30,000 USDC**. Отже, $K = 10 \times 30,000 = 300,000$.
Поточна ціна: $30,000 / 10 = \$3,000$ за 1 ETH.

Ви хочете купити 1 ETH. Ви забираєте з пулу 1 ETH (тепер там 9 ETH).
Щоб константа $K$ (300,000) збереглася, формула вимагає, щоб у пулі стало $300,000 / 9 = 33,333.33$ USDC.
Було 30,000 USDC. Отже, ви повинні докласти в пул $33,333.33 - 30,000 = 3,333.33$ USDC.
Ви купили 1 ETH за **\$3,333**, хоча "ринкова" ціна була \$3,000. Ця різниця називається **Прослизанням ціни (Slippage)**. Чим менше пул, тим вище прослизання.

---

## 2. Арбітраж (Arbitrage)

Арбітраж — це безризиковий заробіток на різниці цін одного і того ж активу на різних ринках. У DeFi алгоритмічні ціни (як ми бачили вище) можуть легко відхилятися від світових ринкових цін.

### Приклад:
*   На Binance (централізована біржа) 1 ETH коштує **$3,000**.
*   На Uniswap (децентралізована біржа) хтось щойно купив багато ETH, і через математику пулу (slippage) ціна ETH там зросла до **$3,100**.

**Що робить Арбітражер (або його бот):**
1.  Купує 1 ETH на Binance за $3,000.
2.  Переказує його на свій гаманець (комісія мережі, скажімо, $10).
3.  Продає цей 1 ETH на Uniswap за $3,100.
4.  **Чистий прибуток:** $3,100 - $3,000 - $10 (комісія) = **$90** за пару секунд.

### Чому арбітраж корисний для DeFi?
У AMM пулах немає "адміністратора", який встановлює правильну ціну. Ціна підтримується виключно завдяки арбітражерам! Як тільки ціна стає неадекватною, боти-арбітражери миттєво купують або продають актив, повертаючи ціну до середньоринкової (заробляючи при цьому гроші). 

---

## 3. Кредитне плече (Leverage) та Ліквідація

Унікальна риса DeFi — **Over-collateralized Lending (Надмірна застава)**.
Оскільки в блокчейні немає судів і колекторів, ви не можете взяти кредит "під чесне слово" або кредитну історію. Ви повинні залишити заставу (Collateral), яка коштує **більше**, ніж сума, яку ви берете.

### Навіщо брати гроші, якщо в тебе їх і так достатньо?
Для **Кредитного плеча (Leverage)**. Це спосіб множити прибуток від зростання активу, який ви вірите, але не маєте достатньо готівки, щоб купити його ще більше.

**Приклад (Long позиція):**
1. У вас є $10,000 у токенах ETH. Ви вірите, що ETH виросте. Якщо він зросте на 10%, ви заробите $1,000. Це нудно.
2. Ви йдете на протокол (наприклад, Aave) і кладете свої $10,000 в ETH як *заставу*. 
3. Під цю заставу протокол дозволяє вам взяти кредит у "стабільних монетах" (USDC) на суму $5,000 (оскільки кредит має бути менший за заставу).
4. Ви берете ці $5,000 USDC і одразу купуєте на них ще ETH!
5. Тепер у вас позиція не на $10,000, а на **$15,000** в ETH. Ви використали "Плече 1.5x".
6. Якщо ETH виросте на 10%, ви продасте куплені $15,000 ETH за $16,500. Повернете борг $5,000. Ваш чистий капітал: $11,500. Ваш прибуток: $1,500 замість $1,000.

### Ризик Ліквідації (Liquidation)
Ринок має дві сторони. Що, якщо ціна ETH впаде?
Ваша застава ($10,000 в ETH) починає дешевшати. Смарт-контракт протоколу невблаганний. У нього є правило: *"Якщо вартість застави падає і стає близькою до вартості виданого боргу ($5,000), кредит має бути примусово закритий"*.

Якщо ETH падає на 40% (застава стає $6,000), протокол розуміє, що якщо ціна впаде ще трохи, він зазнає збитків і не зможе повернути стейблкоїни іншим користувачам. Тому він викликає функцію **Ліквідації**:
Він забирає вашу заставу (ETH), автоматично продає її на ринку (Uniswap), забирає свої $5,000 + штраф за ліквідацію, а жалюгідні залишки віддає вам. **Ви втратили свої позиції та гроші.**

---

## 4. Flash Loans (Миттєві кредити) — Магія чистого DeFi

Це фінансовий інструмент, якого фізично не може існувати у звичайному або фіатному світі. 
**Миттєвий кредит (Flash Loan)** дозволяє позичити *мільйони доларів* без жодної застави, паспорта чи перевірок.

### Як це можливо?
Вся хитрість у транзакціях (Atomicity). Ви берете кредит, робите свої фінансові махінації, заробляєте і **повертаєте кредит разом із відсотками в рамках ОДНІЄЇ ТРАНЗАКЦІЇ**. 

Якщо наприкінці вашої транзакції у вас не вистачило грошей щоб повернути борг контракту, вся транзакція математично відкочується (`Revert`). Стан блокчейну повертається до початкового, ніби ви ніколи й не брали цей кредит.

1.  Це безпечно для Кредитора (бо якщо кредит не повернуть у ту ж секунду, все просто скасується).
2.  Це інструмент для розумних хакерів та арбітражерів (вони беруть Flash Loan на $10,000,000, роблять арбітраж на перекосах цін між пулами A і B, отримують $10,000 прибутку, ліквідують борг повертаючи основне тіло кредиту + мінімальний fee, і залишають прибуток собі, витративши тільки кілька доларів на комісію мережі (Gas)).
