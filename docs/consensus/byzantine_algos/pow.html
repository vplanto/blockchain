<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è: Proof of Work</title>
  <style>
    :root {
      --primary: #007bff;
      --success: #28a745;
      --danger: #dc3545;
      --bg: #f4f7f6;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--bg);
      color: #333;
    }

    h1 { text-align: center; margin-bottom: 5px; }
    .subtitle { text-align: center; color: #666; font-style: italic; margin-bottom: 25px; }

    .instructions {
      max-width: 800px;
      margin: 0 auto 30px;
      padding: 20px;
      background: #ffffff;
      border-radius: 8px;
      border-left: 5px solid var(--primary);
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .instructions h3 { margin-top: 0; }

    /* --- –õ–ê–ù–¶–Æ–ì (Container) --- */
    .chain-wrapper {
      display: flex;
      flex-wrap: nowrap; /* –í–ò–ü–†–ê–í–õ–ï–ù–û: –ó–∞–±–æ—Ä–æ–Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å—É */
      overflow-x: auto;  /* –í–ò–ü–†–ê–í–õ–ï–ù–û: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π —Å–∫—Ä–æ–ª */
      justify-content: flex-start;
      gap: 20px;
      padding: 20px 10px;
      align-items: center; /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ */
      min-height: 450px; /* –ú—ñ—Å—Ü–µ –¥–ª—è –±–ª–æ–∫—ñ–≤ */
      
      /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è —Å–∫—Ä–æ–ª–±–∞—Ä—É */
      scrollbar-width: thin;
      scrollbar-color: #ccc transparent;
    }
    
    .chain-wrapper::-webkit-scrollbar { height: 8px; }
    .chain-wrapper::-webkit-scrollbar-track { background: transparent; }
    .chain-wrapper::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 4px; }

    /* --- –ë–õ–û–ö --- */
    .block {
      flex: 0 0 280px; /* –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —à–∏—Ä–∏–Ω–∞, –Ω–µ —Å—Ç–∏—Å–∫–∞—Ç–∏ */
      padding: 20px;
      border-radius: 12px;
      border: 3px solid #ccc;
      background: white;
      position: relative;
      transition: all 0.3s ease;
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
    }

    .block.valid {
      border-color: var(--success);
      background-color: #f0fff4;
    }
    
    .block.valid .status-badge {
      background: var(--success);
      content: "SIGNED";
    }

    .block.invalid {
      border-color: var(--danger);
      background-color: #fff5f5;
      animation: shake 0.4s ease-in-out;
    }

    .status-badge {
      position: absolute;
      top: -12px;
      right: 20px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      color: white;
      text-transform: uppercase;
      background: #999;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .block.invalid .status-badge {
      background: var(--danger);
      content: "INVALID";
    }

    /* --- –ó–í'–Ø–ó–û–ö (–°—Ç—Ä—ñ–ª–∫–∞) --- */
    .arrow-container {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: #bbb;
      transition: all 0.3s;
      flex-shrink: 0; /* –ù–µ —Å—Ç–∏—Å–∫–∞—Ç–∏ —Å—Ç—Ä—ñ–ª–∫—É */
    }
    .arrow-container.broken {
      color: var(--danger);
      font-size: 42px;
      transform: scale(1.1);
    }

    /* --- –ü–û–õ–Ø --- */
    .field-group { margin-bottom: 12px; }
    label { display: block; font-size: 0.75em; font-weight: bold; text-transform: uppercase; color: #666; margin-bottom: 4px; }
    
    input, textarea {
      width: 90%;
      padding: 8px 10px;
      font-family: 'Consolas', monospace;
      font-size: 13px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fafafa;
    }
    textarea { height: 50px; resize: none; }
    textarea:focus { border-color: var(--primary); outline: none; background: white; }

    /* Hash Colors */
    .hash-val { font-weight: bold; transition: color 0.3s; }
    .block.valid .hash-val { color: #1e7e34; }
    .block.invalid .hash-val { color: #c62828; }

    /* --- –ö–ù–û–ü–ö–ò --- */
    .mine-btn {
      width: 100%;
      padding: 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.2s;
    }
    .mine-btn:hover { background: #0056b3; }
    .mine-btn:disabled { background: #6c757d; cursor: not-allowed; opacity: 0.7; }
    .mine-btn.success { background: var(--success); }
    .mine-btn.mining { background: #ffc107; color: #222; cursor: wait; }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px) rotate(-1deg); }
      75% { transform: translateX(4px) rotate(1deg); }
    }
  </style>
</head>
<body>

  <h1>Proof of Work: –ú–µ—Ö–∞–Ω—ñ–∫–∞ –î–æ–≤—ñ—Ä–∏</h1>
  <div class="subtitle">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ –¥–æ –õ–µ–∫—Ü—ñ—ó 1</div>
  
  <div class="instructions">
    <h3>üõ† –ó–∞–≤–¥–∞–Ω–Ω—è:</h3>
    <ol>
      <li><strong>–ú–∞–π–Ω—ñ–Ω–≥ (Mining):</strong> –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É <b>"‚õè –ü–Ü–î–ü–ò–°–ê–¢–ò"</b> –Ω–∞ –ø–µ—Ä—à–æ–º—É –±–ª–æ—Ü—ñ. –ü—Ä–æ–≥—Ä–∞–º–∞ –ø—ñ–¥–±–µ—Ä–µ —á–∏—Å–ª–æ <code>Nonce</code> —Ç–∞–∫, —â–æ–± —Ö–µ—à –±–ª–æ–∫—É —Å—Ç–∞–≤ "–∫—Ä–∞—Å–∏–≤–∏–º" (–ø–æ—á–∏–Ω–∞–≤—Å—è –∑ —Ü–∏—Ñ—Ä–∏ 0).</li>
      <li><strong>–õ–∞–Ω—Ü—é–≥–æ–≤–∞ —Ä–µ–∞–∫—Ü—ñ—è:</strong> –ü—Ä–æ—Ä–æ–±—ñ—Ç—å —Ü–µ –¥–ª—è –≤—Å—ñ—Ö –±–ª–æ–∫—ñ–≤, –ø–æ–∫–∏ –≤–µ—Å—å –ª–∞–Ω—Ü—é–≥ –Ω–µ —Å—Ç–∞–Ω–µ –∑–µ–ª–µ–Ω–∏–º.</li>
      <li><strong>–ó–ª–∞–º (Hack):</strong> –ó–º—ñ–Ω—ñ—Ç—å —Å—É–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≤ <b>–ë–ª–æ—Ü—ñ #1</b>. –°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞–π—Ç–µ, —è–∫ —Ü–µ –∑—Ä—É–π–Ω—É—î –ø—ñ–¥–ø–∏—Å–∏ –≤—Å—ñ—Ö –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –±–ª–æ–∫—ñ–≤ ("Broken Chain").</li>
    </ol>
  </div>

  <div class="chain-wrapper" id="app"></div>

  <script>
    // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ---
    // Target: Hash must start with '0'. 
    const TARGET_CHAR = '0'; 
    
    function isHashValid(hash) {
      return hash.charAt(0) === TARGET_CHAR;
    }

    // –î–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∞ —Ö–µ—à-—Ñ—É–Ω–∫—Ü—ñ—è
    function simpleHash(val) {
      let hash = 0;
      if (val.length === 0) return "00000000";
      for (let i = 0; i < val.length; i++) {
        const char = val.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; 
      }
      let hex = (hash >>> 0).toString(16);
      while (hex.length < 8) hex = "0" + hex;
      return hex;
    }

    // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ
    const state = [
      { id: 1, nonce: 0, data: "Genesis: System Start", prev: "00000000", hash: "" },
      { id: 2, nonce: 0, data: "Tx: Alice -> Bob (50 UAH)", prev: "", hash: "" },
      { id: 3, nonce: 0, data: "Tx: Bob -> Service (10 UAH)", prev: "", hash: "" },
      { id: 4, nonce: 0, data: "Contract: Deploy Token", prev: "", hash: "" }
    ];

    // --- –Ø–î–†–û ---

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É (–º–∏—Ç—Ç—î–≤–µ)
    function recalcSystem() {
      for (let i = 0; i < state.length; i++) {
        if (i > 0) {
          state[i].prev = state[i-1].hash; 
        }
        const str = state[i].id + state[i].prev + state[i].data + state[i].nonce;
        state[i].hash = simpleHash(str);
      }
      render();
    }

    // "–†–æ–∑—É–º–Ω–∏–π" –ú–∞–π–Ω—ñ–Ω–≥ (Batching)
    function mine(idx) {
      const btn = document.getElementById(`btn-${idx}`);
      btn.innerHTML = "‚öôÔ∏è –ü—ñ–¥–±—ñ—Ä Nonce...";
      btn.classList.add('mining');
      btn.disabled = true;

      const block = state[idx];
      
      // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π —Ü–∏–∫–ª
      function mineLoop() {
        const BATCH_SIZE = 2000; // –†–æ–±–∏–º–æ 2000 —Å–ø—Ä–æ–± –∑–∞ —Ä–∞–∑
        let tries = 0;
        
        while (tries < BATCH_SIZE) {
          block.nonce++;
          const str = block.id + block.prev + block.data + block.nonce;
          block.hash = simpleHash(str);
          
          if (isHashValid(block.hash)) {
            // –ó–Ω–∞–π—à–ª–∏!
            recalcSystem();
            btn.classList.remove('mining');
            return; 
          }
          tries++;
        }
        
        // –í—ñ–¥–¥–∞—î–º–æ –∫–æ–Ω—Ç—Ä–æ–ª—å –±—Ä–∞—É–∑–µ—Ä—É
        setTimeout(mineLoop, 0);
      }

      // –°—Ç–∞—Ä—Ç
      setTimeout(mineLoop, 10);
    }

    function updateData(idx, val) {
      state[idx].data = val;
      recalcSystem();
    }

    // --- –í–Ü–ó–£–ê–õ–Ü–ó–ê–¶–Ü–Ø ---
    function render() {
      const app = document.getElementById('app');
      app.innerHTML = '';

      state.forEach((block, idx) => {
        const hashOk = isHashValid(block.hash);
        const isValid = hashOk; // –í–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å –±–ª–æ–∫—É –∑–∞–ª–µ–∂–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥ PoW

        const div = document.createElement('div');
        div.className = `block ${isValid ? 'valid' : 'invalid'}`;
        
        const statusText = isValid ? "SIGNED" : "INVALID";
        
        div.innerHTML = `
          <div class="status-badge">${statusText}</div>
          
          <div class="field-group">
            <label>Block ID</label>
            <input value="#${block.id}" disabled style="font-weight:bold;">
          </div>
          
          <div class="field-group">
            <label>Nonce (Proof)</label>
            <input value="${block.nonce}" disabled>
          </div>
          
          <div class="field-group">
            <label>Data (–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó)</label>
            <textarea oninput="updateData(${idx}, this.value)">${block.data}</textarea>
          </div>
          
          <div class="field-group">
            <label>Previous Hash</label>
            <input value="${block.prev}" disabled class="hash-val" style="font-size:11px">
          </div>
          
          <div class="field-group">
            <label>Block Hash (Target: ${TARGET_CHAR}...)</label>
            <input value="${block.hash}" disabled class="hash-val">
          </div>
          
          <button id="btn-${idx}" class="mine-btn ${isValid ? 'success' : ''}" 
            onclick="mine(${idx})" ${isValid ? 'disabled' : ''}>
            ${isValid ? '‚úÖ –ë–ª–æ–∫ –ü—ñ–¥–ø–∏—Å–∞–Ω–æ' : '‚õè –ü–Ü–î–ü–ò–°–ê–¢–ò (Mine)'}
          </button>
        `;

        if (idx > 0) {
          const arrow = document.createElement('div');
          const prevBlockValid = isHashValid(state[idx-1].hash);
          arrow.className = `arrow-container ${prevBlockValid ? '' : 'broken'}`;
          arrow.innerHTML = prevBlockValid ? '‚û°' : '‚ùå';
          app.appendChild(arrow);
        }

        app.appendChild(div);
      });
    }

    // --- GARANTEED INVALID START (SABOTAGE) ---
    // –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø–µ—Ä—à–∏–π –±–ª–æ–∫. –Ø–∫—â–æ –≤—ñ–Ω –≤–∏–ø–∞–¥–∫–æ–≤–æ "–∑–µ–ª–µ–Ω–∏–π",
    // –≤–æ–Ω–∞ –∑–±—ñ–ª—å—à—É—î Nonce, –ø–æ–∫–∏ –≤—ñ–Ω –Ω–µ —Å—Ç–∞–Ω–µ "—á–µ—Ä–≤–æ–Ω–∏–º".
    function sabotageGenesis() {
       let currentHash = simpleHash(state[0].id + state[0].prev + state[0].data + state[0].nonce);
       
       // –ü–æ–∫–∏ —Ö–µ—à "–≥–∞—Ä–Ω–∏–π" (–≤–∞–ª—ñ–¥–Ω–∏–π) ‚Äî –ø—Å—É—î–º–æ –π–æ–≥–æ, –∑–±—ñ–ª—å—à—É—é—á–∏ Nonce
       while (isHashValid(currentHash)) {
         state[0].nonce++; 
         currentHash = simpleHash(state[0].id + state[0].prev + state[0].data + state[0].nonce);
       }
    }

    // –ó–∞–ø—É—Å–∫: —Å–ø–æ—á–∞—Ç–∫—É —Å–∞–±–æ—Ç–∞–∂, –ø–æ—Ç—ñ–º —Ä–µ–Ω–¥–µ—Ä
    sabotageGenesis();
    recalcSystem();

  </script>
</body>
</html>